"use strict";var t=require("../../common/vendor.js");const e={data(){return{content:"",list:this.getList(),status:"正在加载留言",mode:"getMessages",timer:null}},onLoad(){let e=t.index.getStorageSync("token");t.index.login().then((({code:s})=>{t.pn.callFunction({name:"fun",data:{api:"loginWithMp",code:s}}).then((({result:s})=>{e=s.token,t.index.setStorageSync("token",e),this.getList()}))})),this.timer=setInterval((()=>this.getList(this.mode)),2500)},onUnload(){clearInterval(this.timer)},methods:{getList(e){t.pn.callFunction({name:"fun",data:{api:e||"getMessages",token:t.index.getStorageSync("token")}}).then((t=>{this.list=t.result.data,this.status=0==this.list?"留言板是空的":"所有留言内容"}))},publish(){if(this.mode="getMessages",!this.content.trim())return t.index.showToast({title:"留言无效",icon:"error"}),void(this.status="留言无效");t.pn.callFunction({name:"fun",data:{api:"publish",content:this.content,token:t.index.getStorageSync("token")}}).then((e=>{if(!1===e.result.success)return console.log(e.result.errMsg),t.index.showToast({icon:"error",title:e.result.errMsg}),this.content="",void(this.status="留言失败");this.status="留言成功",t.index.showToast({title:"留言成功",icon:"success"}),this.content=""}))},changeMode(){"getMessages"!==this.mode?"getMyMessages"!==this.mode||(this.mode="getMessages"):this.mode="getMyMessages"}}};var s=t._export_sfc(e,[["render",function(e,s,n,i,o,a){return t.e({a:o.content,b:t.o((t=>o.content=t.detail.value)),c:t.o((t=>a.publish())),d:"getMessages"===o.mode},(o.mode,{}),{e:t.o((t=>{a.changeMode(),a.getList(o.mode)})),f:t.t(o.status),g:t.f(o.list,((e,s,n)=>t.e({a:t.t(e.content),b:t.t(e.time),c:!e.public},(e.public,{}),{d:e.backgroundColor,e:e._id})))})}]]);wx.createPage(s);
