import{h as t,A as e,n as s,p as a,j as l,o as n,c as i,w as o,a as r,b as u,t as c,d,r as f,F as h,I as m,D as g,e as p,i as x,u as _}from"./index.3a624072.js";import{_ as k}from"./plugin-vue_export-helper.21dcd24c.js";var y=k({data(){return{content:"",list:this.getList(),status:"正在加载留言",timer:null,onLogin:!1}},onLoad(){this.timer=setInterval((()=>this.getList()),2500)},onUnload(){clearInterval(this.timer)},onShow(){this.onLogin||(this.onLogin=!0,this.content&&t("token")&&this.publish())},methods:{checkToken(){if(!t("token"))return e({title:"请先登录",icon:"error"}),s({url:"/pages/ucenter/login/login"}),void(this.onLogin=!0)},getList(t){a.callFunction({name:"fun",data:{api:t||"getMessages"}}).then((t=>{this.list=t.result.data,this.status=0==this.list?"留言板是空的":"所有留言内容"}))},publish(){if(!1!==this.onLogin)return this.content.trim()?void a.callFunction({name:"fun",data:{api:"addMessage",args:{content:this.content},token:t("token")}}).then((t=>{if(!1===t.result.success)throw Error(t.result.errorMessage);this.status="留言成功",e({title:"留言成功",icon:"success"}),this.content=""})).catch((t=>{l("log","at pages/ucenter/messageBoard/messageBoard.vue:107",t),e({title:"留言失败",icon:"error"})})):(e({title:"留言无效",icon:"error"}),void(this.status="留言无效"))}}},[["render",function(t,e,s,a,l,k){const y=m,v=g,b=p,L=x;return n(),i(b,null,{default:o((()=>[r(b,{class:"flex justify-center items-center inputArea"},{default:o((()=>[r(b,{class:"flex flex-row"},{default:o((()=>[r(y,{type:"text",class:"flex input",style:{width:"480rpx"},modelValue:l.content,"onUpdate:modelValue":e[0]||(e[0]=t=>l.content=t),placeholder:"在这里写上你的留言"},null,8,["modelValue"]),r(v,{type:"primary",class:"flex",onClick:e[1]||(e[1]=t=>(k.checkToken(),k.publish())),size:"mini",style:{"margin-left":"10px"}},{default:o((()=>[u("发布")])),_:1})])),_:1})])),_:1}),r(b,{class:"flex justify-center items-center status"},{default:o((()=>[r(L,null,{default:o((()=>[u(c(l.status),1)])),_:1})])),_:1}),r(b,{class:"flex justify-center items-center flex-col-reverse scroll-smooth"},{default:o((()=>[(n(!0),d(h,null,f(l.list,(t=>(n(),i(b,{key:t._id},{default:o((()=>[r(b,{class:"flex flex-row box",style:_({background:t.backgroundColor})},{default:o((()=>[r(b,null,{default:o((()=>[r(b,{style:{"font-size":"1.3rem","word-break":"break-all"}},{default:o((()=>[u(c(t.content),1)])),_:2},1024),r(b,{style:{"font-size":"1rem"}},{default:o((()=>[u(c(t.time),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["style"])])),_:2},1024)))),128))])),_:1})])),_:1})}],["__scopeId","data-v-64d04d28"]]);export{y as default};
